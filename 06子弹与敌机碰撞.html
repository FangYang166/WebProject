<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Title</title>
		<style>
			* {
			            margin: 0;
			            padding: 0;
			        }
			
					//飞机场场景框
			        #wrap {
			            width: 400px;
			            height: 600px;
			            margin: 20px auto;
			            position: relative;
			            border: 1px solid red;
			            overflow: hidden;
			        }
			
			        #myplan {
			            width: 98px;
			            height: 122px;
			            background: url("images/me.png");
			            background-size: 98px 122px;
			            position: absolute;
			            left: 151px;
			            bottom: 0;
			        }
			
			        .bullet {
			            width: 8px;
			            height: 18px;
			            background: url("images/bullet.png");
			            position: absolute;
			        }
			
			        .plain1 {
			            width: 60px;
			            height: 36px;
			            position: absolute;
			            background: url("images/plain1.png");
			        }
			        
			        .plain2{
			        	width: 70px;
			        	height: 92px;
			        	position: absolute;
						background: url("images/plain2.png");
			        }
			        
			        .plain3{
			        	width: 166px;
			        	height: 256px;
			        	position: absolute;
			        	background: url("images/plain3.png");
			        }
			        
			        #myScore{
			        	height: 50px;
			        	width: 50px;
			        	background: rgba(110,110,50,0.3);
			        	position: absolute;
						left: 0;
						top: 0;
						text-align: center;
						line-height: 50px;
						color: #FF0000;
						font-size: 14px;
						font-weight: 400px;
			        }
			        
			        #mylife{
			        	position: absolute;
			        	height: 300px;
			        	left: 0;
			        	bottom: 0;
			        	width: 20px;
			        	background: rgba(255,0,0,0.5);
			        	border-radius: 10px;	
			        }
		</style>
	</head>

	<body>
		<div id="wrap">
			<div id="myplan"></div>
			<div id="myScore">0</div>
			<div id="mylife"></div>
		</div>
	</body>
	<script>
		var wrap = document.getElementById("wrap");
		var myplan = document.getElementById("myplan");
		var wrapHeight = wrap.offsetHeight;
		var wrapWidth = wrap.offsetWidth;
		var myplanHeight = myplan.offsetHeight
		var myplanWidth = myplan.offsetWidth; //找到飞机场的高度宽度和飞机本身的高度和宽度
		var wrapLeft = wrap.offsetLeft; //飞机场相对于父元素的距离
		var wrapTop = wrap.offsetTop;
		var maxLeft = wrapWidth - myplanWidth;
		var maxTop = wrapHeight - myplanHeight;
		var createBulletTimer = null;
		var createPlainTimer = null;
		var bulletSpeed = 10;
		var plainSpeed = 10;
		//初始化分数
		var score = 0;
		createPlain();

		function createPlain() { //表示创造敌机
			var plain = document.createElement("div");
			//boss飞机出场时机
			if (score > 50) {
				plain.className = "plain3";
				plain.life = 100;
				plain.score = 500;
				wrap.appendChild(plain);
				var bossLeft = wrapWidth - plain.offsetWidth;
			} else {
				//小飞机出场时机
				if (score > 10) {
					plain.className = "plain2";
					plain.life = 3;
					plain.score = 5;
				} else {
					plain.className = "plain1";
					plain.life = 1;
					plain.score = 1;
				}
			}
			wrap.appendChild(plain);
			var maxLeft = wrapWidth - plain.offsetWidth; //最大左边的距离
			var x = Math.round(Math.random() * maxLeft); //随机产生一个距离（在最大值和最小值之间）
			plain.style.left = x + "px";
			//让敌机降落
			plain.timer = setInterval(function() {
				plain.style.top = plain.offsetTop + plainSpeed + "px";
				//敌机消失(敌机整机移除出去)
				if (plain.offsetTop >= wrapHeight) {
					clearInterval(plain.timer);
					wrap.removeChild(plain);
				}
			}, 100);
			createPlainTimer = setTimeout(createPlain, 500);
		}
		createBullet();

		function createBullet() {
			var bullet = document.createElement("div");
			bullet.className = "bullet";
			wrap.appendChild(bullet);
			//重新定位子弹的位置(根据飞机的位置来定义) 飞机距离左边的距离+飞机宽度的一半减去子弹宽度的一半
			var x = myplan.offsetLeft + (myplanWidth / 2) - bullet.offsetWidth / 2;
			var y = myplan.offsetTop - bullet.offsetHeight;
			bullet.style.left = x + "px";
			bullet.style.top = y + "px";
			//子弹发射的代码
			bullet.timer = setInterval(function() {
				bullet.style.top = bullet.offsetTop - bulletSpeed + "px";
				//子弹、敌机碰撞检测
				var bulletX = bullet.offsetLeft;
				var bulletY = bullet.offsetTop;
				var plainList = document.getElementsByClassName("plain");
				for (var i = 0; i < plainList.length; i++) {
					var plain = plainList[i];
					var plainLeft = plain.offsetLeft;
					var plainTop = plain.offsetTop;
					var minX = plainLeft - bullet.offsetWidth;
					var maxX = plainLeft + plain.offsetWidth;
					var minY = plainTop - bullet.offsetHeight;
					var minY = plainTop + plain.offsetHeight;
					if (bulletX >= minX && bulletX <= maxX && bulletY >= minY && bullet <= maxY) {
						clearInterval(bullet.timer);
						wrap.removeChild(bullet);
						plain.life-=1;
						if (plain.life <=0) {
							clearInterval(plain.timer);
							score=score+plain.score;
							document.getElementById("myScore").innerHTML=score;
							wrap.removeChild(plain);
						}
						
					}
				} 
				//当子弹到达临界条件以后  需要消失(从页面做一个清除)
				//if (bullet.offsetTop <= 0) {
				//clearInterval(bullet.timer);//让子弹停止运动
				//wrap.removeChild(bullet);//将子弹从飞机场移除
				if (getStyleAttr(bullet, "top") <= 0) {
					clearInterval(bullet, timer);
					wrap.removeChild();
				}
			}, 100); //表示0.1秒 1000毫秒 = 1秒
			createBulletTimer = setTimeout(createBullet, 100);
		}
		wrap.onmousemove = function(e) { //当鼠标在该区域移动的时候 触发该function
			var evt = window.event || e; //事件的兼容
			evt.stopPropagation(); //阻止事件的传递
			var clientX = evt.clientX; //事件相对于文档的距离
			var clientY = evt.clientY;
			var x = clientX - wrapLeft - myplanWidth / 2;
			var y = clientY - wrapTop - myplanHeight / 2;
			if (x <= 0) {
				x = 0;
			}
			if (y <= 0) {
				y = 0;
			}
			if (x >= maxLeft) {
				x = maxLeft;
			}
			if (y >= maxTop) {
				y = maxTop;
			}
			myplan.style.left = x + "px";
			myplan.style.top = y + "px";
		}
		
		//敌机与子弹的碰撞检测
		bullet.timer = setInterval(function() { //这里表示子弹在运动
			bullet.style.top = getStyelAttr(bullet, "top") - bulletSpeed + "px";
			var bulletX = bullet.offsetLeft;
			var bulletY = bullet.offsetTop;
			var plainList = document.getElementsByClassName("plain"); //表示找到了所有的敌机
			for (var i = 0; i < plainList.length; i++) {
				var plain = plainList[i];
				var minX = plain.offsetLeft - bullet.offsetWidth;
				var maxX = plain.offsetLeft + plain.offsetWidth;
				var minY = plain.offsetTop - bullet.offsetHeight;
				var maxY = plain.offsetTop + plain.offsetHeight;
				if (bulletX >= minX && bulletX <= maxX && bulletY >= minY && bulletY <= maxY) {
					clearInterval(plain.timer);
					//                clearInterval(bullet.timer);
					wrap.removeChild(bullet);
					plain.life = plain.life - 1;
					if (plain.life <= 0) {
						clearInterval(plain, timer);
						score += plain.score;
					}
					wrap.removeChild(plain);
				}
			}
			//当子弹到达临界条件后消失
			if (getStyelAttr(bullet, "top") <= 0) {
				wrap.removeChild(bullet);
				clearInterval(bullet.timer);
			}
		}, 100);
		
		
		//我方飞机的坠毁
		myplan.timer = setInterval(function() {
			var minX = myplan.offsetLeft - plain.offsetWidth;
			var maxX = myplan.offsetLeft + myplan.offsetWidth;
			var minY = myplan.offsetTop - plain.offsetHeight;
			var maxY = myplan.offsetTop + myplan.offsetHeight;
		
		
			if (plainLeft >= minX && plainLeft <= maxX && plainTop >= minY && plainTop <= maxY) {
				clearInterval(plain);
				wrap.removeChild(plain);
				myplan.life = myplan.life - 1;
				mylife.Style.height = myplan.life * 100 + "px";
		
				if (myplan.life <= 0) {
					clearInterval(myplan.timer);
					wrap.removeChild()
				}
		
			}
		})


		//boss机出场以及移动
		plain.timer = setInterval(function(){
			var minX = myplan.offsetLeft - plain.offsetWidth;
			var maxX = myplan.offsetLeft + myplan.offsetWidth;
			var minY = myplan.offsetTop - plain.offsetHeight;
			var maxY = myplan.offsetTop + myplan.offsetHeight;
			
			if (plainLeft >= minX && plainLeft <= maxX && plainTop >= minY && plainTop <= maxY) {
				//boss机与我机碰撞检测
				plain.life=plain-100;
				if (plain.life<=0) {
					clearInterval(plain.timer);
					wrap.removeChild(plain);
					score=score+plain.score;
					
					if (confirm("过关！！")) {
						
					}else{
						window.close();
					}
				}
				
				myplan.life = myplan - 1;
				mylife.Style.height = myplan.life * 100 + "px";
				if (mylife == 0) {
					
				} else{
					
				}
			}
			
		})



		function getStyleAttr(obj, attr) {
			if (window.getComputedStyle) {
				return parseFloat(window.getComputedStyle(obj)[attr]);
			} else {
				return obj.currentStyle[attr];
			}
		}
	</script>
</html>